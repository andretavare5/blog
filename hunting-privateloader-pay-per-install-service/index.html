<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Hunting PrivateLoader: Pay-Per-Install Service - tavares.re</title><meta name=Description content="The malware's uncommon string decryption technique enable us to write a Yara rule for detection and hunting purposes."><meta property="og:title" content="Hunting PrivateLoader: Pay-Per-Install Service"><meta property="og:description" content="The malware's uncommon string decryption technique enable us to write a Yara rule for detection and hunting purposes."><meta property="og:type" content="article"><meta property="og:url" content="https://tavares.re/hunting-privateloader-pay-per-install-service/"><meta property="og:image" content="https://tavares.re/hunting-privateloader-pay-per-install-service/andreas-brun-f1SLpsPGODo-unsplash.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-06T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-06T08:33:34+00:00"><meta property="og:site_name" content="tavares.re"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tavares.re/hunting-privateloader-pay-per-install-service/andreas-brun-f1SLpsPGODo-unsplash.webp"><meta name=twitter:title content="Hunting PrivateLoader: Pay-Per-Install Service"><meta name=twitter:description content="The malware's uncommon string decryption technique enable us to write a Yara rule for detection and hunting purposes."><meta name=application-name content="tavares.re"><meta name=apple-mobile-web-app-title content="tavares.re"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://tavares.re/hunting-privateloader-pay-per-install-service/><link rel=prev href=https://tavares.re/flubot-persists-infecting-europe-and-australia/><link rel=next href=https://tavares.re/tracking-privateloader-malware-distribution-service/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Hunting PrivateLoader: Pay-Per-Install Service","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/tavares.re\/hunting-privateloader-pay-per-install-service\/"},"image":[{"@type":"ImageObject","url":"https:\/\/tavares.re\/hunting-privateloader-pay-per-install-service\/andreas-brun-f1SLpsPGODo-unsplash.webp","width":6048,"height":4024}],"genre":"posts","keywords":"privateloader, malware, loader, reversing, yara, windows","wordcount":719,"url":"https:\/\/tavares.re\/hunting-privateloader-pay-per-install-service\/","datePublished":"2022-06-06T00:00:00+00:00","dateModified":"2022-11-06T08:33:34+00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"https:\/\/tavares.re\/images\/avatar.jpg","width":2400,"height":2400}},"author":{"@type":"Person","name":"André Tavares"},"description":"The malware's uncommon string decryption technique enable us to write a Yara rule for detection and hunting purposes."}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=tavares.re>tavares.re</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/>Home </a><a class=menu-item href=/about/>About </a><a class=menu-item href=/posts/>Posts </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=tavares.re>tavares.re</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/ title>Home</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=/posts/ title>Posts</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated">Hunting PrivateLoader: Pay-Per-Install Service</h1><div class=post-meta><div class=post-meta-line></div><div class=post-meta-line><span class=post-author><a href=https://twitter.com/andretavare5 title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>André Tavares</a></span>&nbsp;<i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime="Jun 6, 2022">Jun 6, 2022</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;719 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;&nbsp;<span class=post-category><a href=/categories/malware/><i class="far fa-folder fa-fw" aria-hidden=true></i>malware</a></span></div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/hunting-privateloader-pay-per-install-service/andreas-brun-f1SLpsPGODo-unsplash.webp data-srcset="/hunting-privateloader-pay-per-install-service/andreas-brun-f1SLpsPGODo-unsplash.webp, /hunting-privateloader-pay-per-install-service/andreas-brun-f1SLpsPGODo-unsplash.webp 1.5x, /hunting-privateloader-pay-per-install-service/andreas-brun-f1SLpsPGODo-unsplash.webp 2x" data-sizes=auto alt=/hunting-privateloader-pay-per-install-service/andreas-brun-f1SLpsPGODo-unsplash.webp title="The malware's uncommon string decryption technique enable us to write a Yara rule for detection and hunting purposes."></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#encrypted-stack-strings>Encrypted Stack Strings</a></li><li><a href=#decrypting-the-strings>Decrypting The Strings</a></li><li><a href=#detecting-the-malware>Detecting The Malware</a></li></ul></nav></div></div><div class=content id=content><p>PrivateLoader is a loader from a pay-per-install malware distribution service that has been utilized to distribute info stealers, banking trojans, loaders, spambots, rats, miners and ransomware on Windows machines. <a href=https://intel471.com/blog/privateloader-malware target=_blank rel="noopener noreffer">First seen in early 2021</a>, being hosted on websites that claim to provide cracked software, the customers of the service are able to selectively deliver malware to victims based on location, financial activity, environment, and specific software installed.</p><p>Let&rsquo;s have a look at the malware and try to find a way to detect and hunt it.</p><h2 id=encrypted-stack-strings>Encrypted Stack Strings</h2><p>Here&rsquo;s a <a href=https://tria.ge/220430-z8fbmaagb9 target=_blank rel="noopener noreffer">sample</a> analyzed by <a href=https://www.zscaler.com/blogs/security-research/peeking-privateloader target=_blank rel="noopener noreffer">Zscaler</a> on April 2022:</p><p><code>aa2c0a9e34f9fa4cbf1780d757cc84f32a8bd005142012e91a6888167f80f4d5</code></p><p>Let&rsquo;s open it on <a href=https://ghidra-sre.org/ target=_blank rel="noopener noreffer">Ghidra</a>. Going into the entry point, following the code, looking for interesting functions, I quickly spot the function at <code>0x406360</code>. It&rsquo;s calling <code>LoadLibraryA</code> but the <code>lpLibFileName</code> parameter is built dynamically at runtime using the stack. Its seems that we found a string encryption technique. Both the string and the xor key are loaded into the stack. Looking a bit more through the function, its seems that this is the way most of the strings are loaded:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm><span class=line><span class=cl><span class=nf>LEA</span>       <span class=nb>EAX</span><span class=err>=</span><span class=o>&gt;</span><span class=nv>local_50</span><span class=p>,[</span><span class=nb>ESP</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>MOV</span>       <span class=kt>dword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ESP</span> <span class=o>+</span> <span class=nv>local_50</span><span class=p>[</span><span class=mi>0</span><span class=p>]],</span><span class=mh>0x84038676</span>
</span></span><span class=line><span class=cl><span class=nf>MOV</span>       <span class=kt>dword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ESP</span> <span class=o>+</span> <span class=nv>local_50</span><span class=p>[</span><span class=mi>4</span><span class=p>]],</span><span class=mh>0xeb71eb3c</span>
</span></span><span class=line><span class=cl><span class=nf>MOV</span>       <span class=kt>dword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ESP</span> <span class=o>+</span> <span class=nv>local_50</span><span class=p>[</span><span class=mi>8</span><span class=p>]],</span><span class=mh>0x36fb7b30</span>
</span></span><span class=line><span class=cl><span class=nf>MOV</span>       <span class=kt>dword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ESP</span> <span class=o>+</span> <span class=nv>local_50</span><span class=p>[</span><span class=mi>12</span><span class=p>]],</span><span class=mh>0xab7d1f0c</span>
</span></span><span class=line><span class=cl><span class=nf>MOVAPS</span>    <span class=nv>XMM1</span><span class=p>,</span><span class=nv>xmmword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ESP</span> <span class=o>+</span> <span class=nv>local_50</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=nf>MOV</span>       <span class=kt>dword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ESP</span> <span class=o>+</span> <span class=nv>local_30</span><span class=p>[</span><span class=mi>0</span><span class=p>]],</span><span class=mh>0xea71e31d</span>
</span></span><span class=line><span class=cl><span class=nf>MOV</span>       <span class=kt>dword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ESP</span> <span class=o>+</span> <span class=nv>local_30</span><span class=p>[</span><span class=mi>4</span><span class=p>]],</span><span class=mh>0xd9428759</span>
</span></span><span class=line><span class=cl><span class=nf>MOV</span>       <span class=kt>dword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ESP</span> <span class=o>+</span> <span class=nv>local_30</span><span class=p>[</span><span class=mi>8</span><span class=p>]],</span><span class=mh>0x5a971f1e</span>
</span></span><span class=line><span class=cl><span class=nf>MOV</span>       <span class=kt>dword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ESP</span> <span class=o>+</span> <span class=nv>local_30</span><span class=p>[</span><span class=mi>12</span><span class=p>]],</span><span class=mh>0xab7d1f0c</span>
</span></span><span class=line><span class=cl><span class=nf>PXOR</span>      <span class=nv>XMM1</span><span class=p>,</span><span class=nv>xmmword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ESP</span> <span class=o>+</span> <span class=nv>local_30</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span> <span class=c1>; kernel32.dll</span>
</span></span><span class=line><span class=cl><span class=nf>PUSH</span>      <span class=nb>EAX</span>  <span class=c1>; LPCSTR lpLibFileName for LoadLibraryA</span>
</span></span><span class=line><span class=cl><span class=nf>MOVAPS</span>    <span class=nv>xmmword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ESP</span> <span class=o>+</span> <span class=nv>local_50</span><span class=p>[</span><span class=mi>0</span><span class=p>]],</span><span class=nv>XMM1</span>
</span></span><span class=line><span class=cl><span class=nf>CALL</span>      <span class=nb>ESI</span><span class=err>=</span><span class=o>&gt;</span><span class=nv>KERNEL32.DLL</span><span class=p>::</span><span class=nv>LoadLibraryA</span>
</span></span></code></pre></td></tr></table></div></div><p>After XOR the encrypted string with the key, we get <code>kernel32.dll</code>.</p><h2 id=decrypting-the-strings>Decrypting The Strings</h2><p>Now, to faster analyze the malware and better understand its behavior, we should build a string decryptor to help us on our reversing efforts and better document the code. With the help of <a href=https://www.capstone-engine.org/ target=_blank rel="noopener noreffer">Capstone</a> disassembly framework, and some trial and error, here&rsquo;s the script:</p><script type=application/javascript src=https://gist.github.com/andretavare5/66ec413cdb4c7c39d35c22d38c7067a8.js></script><p>After running it against the sample we are analyzing, we get the following strings:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0x4003ee GetCurrentProcess
</span></span><span class=line><span class=cl>0x400469 CreateThread
</span></span><span class=line><span class=cl>0x4004ba CreateFileA
</span></span><span class=line><span class=cl>0x400506 Sleep
</span></span><span class=line><span class=cl>0x400572 SetPriorityClass
</span></span><span class=line><span class=cl>0x4005ec Shell32.dll
</span></span><span class=line><span class=cl>0x400657 SHGetFolderPathA
</span></span><span class=line><span class=cl>0x40083b null
</span></span><span class=line><span class=cl>0x401078 rb
</span></span><span class=line><span class=cl>0x40157c http://212.193.30.45/proxies.txt
</span></span><span class=line><span class=cl>0x401795 :1080
</span></span><span class=line><span class=cl>0x401839 \n
</span></span><span class=line><span class=cl>0x401f2d :1080
</span></span><span class=line><span class=cl>0x401fd1 :
</span></span><span class=line><span class=cl>0x4026ce .
</span></span><span class=line><span class=cl>0x4028ac .
</span></span><span class=line><span class=cl>0x402972 .
</span></span><span class=line><span class=cl>0x402a34 .
</span></span><span class=line><span class=cl>0x4032ad http://45.144.225.57/server.txt
</span></span><span class=line><span class=cl>0x4033c0 HOST:
</span></span><span class=line><span class=cl>0x40346e :
</span></span><span class=line><span class=cl>0x403760 pastebin.com/raw/A7dSG1te
</span></span><span class=line><span class=cl>0x403965 HOST:
</span></span><span class=line><span class=cl>0x403b93 http://wfsdragon.ru/api/setStats.php
</span></span><span class=line><span class=cl>0x403dcd HOST:
</span></span><span class=line><span class=cl>0x403f84 :
</span></span><span class=line><span class=cl>0x4040ae 2.56.59.42
</span></span><span class=line><span class=cl>0x404350 /base/api/statistics.php
</span></span><span class=line><span class=cl>0x404439 URL:
</span></span><span class=line><span class=cl>0x4044b6 :
</span></span><span class=line><span class=cl>0x404a5e https://
</span></span><span class=line><span class=cl>0x404ad8 .tmp
</span></span><span class=line><span class=cl>0x404bf6 \
</span></span><span class=line><span class=cl>0x4053e9 kernel32.dll
</span></span><span class=line><span class=cl>0x40544a WINHTTP.dll
</span></span><span class=line><span class=cl>0x4054a5 wininet.dll
</span></span><span class=line><span class=cl>0x406616 WinHttpConnect
</span></span><span class=line><span class=cl>0x406682 WinHttpOpenRequest
</span></span><span class=line><span class=cl>0x40671a WinHttpQueryDataAvailable
</span></span><span class=line><span class=cl>0x4067b2 WinHttpSendRequest
</span></span><span class=line><span class=cl>0x40684a WinHttpReceiveResponse
</span></span><span class=line><span class=cl>0x4068e2 WinHttpQueryHeaders
</span></span><span class=line><span class=cl>0x406956 WinHttpOpen
</span></span><span class=line><span class=cl>0x4069b5 WinHttpReadData
</span></span><span class=line><span class=cl>0x406a20 WinHttpCloseHandle
</span></span><span class=line><span class=cl>0x406b09 Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36
</span></span><span class=line><span class=cl>0x407402 http://
</span></span><span class=line><span class=cl>0x4074ab /
</span></span><span class=line><span class=cl>0x407582 ?
</span></span><span class=line><span class=cl>0x40851a HEAD
</span></span><span class=line><span class=cl>0x408fa8 Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36
</span></span><span class=line><span class=cl>0x4091f0 wininet.dll
</span></span><span class=line><span class=cl>0x40925b InternetSetOptionA
</span></span><span class=line><span class=cl>0x4092ef HttpOpenRequestA
</span></span><span class=line><span class=cl>0x40938d InternetConnectA
</span></span><span class=line><span class=cl>0x409421 InternetOpenUrlA
</span></span><span class=line><span class=cl>0x40949e InternetOpenA
</span></span><span class=line><span class=cl>0x4094f2 HttpQueryInfoA
</span></span><span class=line><span class=cl>0x409567 InternetQueryOptionA
</span></span><span class=line><span class=cl>0x4095fb HttpSendRequestA
</span></span><span class=line><span class=cl>0x409694 InternetReadFile
</span></span><span class=line><span class=cl>0x409737 InternetCloseHandle
</span></span><span class=line><span class=cl>0x4097ad Kernel32.dll
</span></span><span class=line><span class=cl>0x409801 HeapAlloc
</span></span><span class=line><span class=cl>0x409852 HeapFree
</span></span><span class=line><span class=cl>0x4098a3 GetProcessHeap
</span></span><span class=line><span class=cl>0x4098f3 CharNextA
</span></span><span class=line><span class=cl>0x409938 User32.dll
</span></span><span class=line><span class=cl>0x409994 GetLastError
</span></span><span class=line><span class=cl>0x4099e5 CreateFileA
</span></span><span class=line><span class=cl>0x409a36 WriteFile
</span></span><span class=line><span class=cl>0x409a87 CloseHandle
</span></span></code></pre></td></tr></table></div></div><p>Some of them are network IoCs that can be used for defense and tracking purposes. We can now go back to Ghidra and continue our analysis, now with more context of what might be the malware&rsquo;s capabilities.</p><h2 id=detecting-the-malware>Detecting The Malware</h2><p>This uncommon string decryption technique enable us to write a <a href=https://github.com/VirusTotal/yara target=_blank rel="noopener noreffer">Yara</a> rule for detection and hunting purposes. To reduce the number of false positives and increase the rule performance, we can add some plaintext unicode strings <a href=https://www.zscaler.com/blogs/security-research/peeking-privateloader target=_blank rel="noopener noreffer">used on the C2 communication</a> and a few minor conditions. Here&rsquo;s the rule:</p><script type=application/javascript src=https://gist.github.com/andretavare5/9d8eb659946ff509d9987c9be4031bb6.js></script><p>After running this rule on VirusTotal retro hunting, I got over 1k samples on a 1 year timeframe. By manually analyzing some of the matches, I couldn&rsquo;t find any false positives. As a first attempt of hunting and detecting PrivateLoader, this rule seems to yield good results.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on Nov 6, 2022&nbsp;<a class=git-hash href=https://github.com/andretavare5/blog/commit/d0452fe8405619efd5026a636db02710609478f1 target=_blank title="commit by Andre Tavares(andre.tavares@bitsightech.com) d0452fe8405619efd5026a636db02710609478f1: update description">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>d0452fe</a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/privateloader/>privateloader</a>,&nbsp;<a href=/tags/malware/>malware</a>,&nbsp;<a href=/tags/loader/>loader</a>,&nbsp;<a href=/tags/reversing/>reversing</a>,&nbsp;<a href=/tags/yara/>yara</a>,&nbsp;<a href=/tags/windows/>windows</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/flubot-persists-infecting-europe-and-australia/ class=prev rel=prev title="FluBot Persists: Infecting Europe and Australia"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>FluBot Persists: Infecting Europe and Australia</a>
<a href=/tracking-privateloader-malware-distribution-service/ class=next rel=next title="Tracking PrivateLoader: Malware Distribution Service">Tracking PrivateLoader: Malware Distribution Service<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://twitter.com/andretavare5 target=_blank>André Tavares</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.117.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:100},comment:{},lightgallery:!0,search:{algoliaAppID:"PASDMWALPK",algoliaIndex:"index.en",algoliaSearchKey:"b42948e51daaa93df92381c8e2ac0f93",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>